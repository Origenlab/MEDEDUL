---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Breadcrumbs from '@/components/seo/Breadcrumbs.astro';
import BlogArchive from '@/components/blog/BlogArchive.astro';
import Hero from '@/components/global/Hero.astro';
import CTAServices from '@/components/global/CTAServices.astro';
import { getCollection } from 'astro:content';
import { sortBlogPosts } from '@/lib/blogSorting';

const PAGE_SIZE = 9;
const allPosts = sortBlogPosts(await getCollection('blog', ({ data }) => !data.draft));

const posts = allPosts.slice(0, PAGE_SIZE);
const totalPages = Math.ceil(allPosts.length / PAGE_SIZE);
const categories = [...new Set(allPosts.map(post => post.data.category))];
const featuredPosts = allPosts.slice(0, 4);

const breadcrumbItems = [
  { name: 'Blog', url: '/blog' }
];
---

<BaseLayout
  title="Blog de Mesas de Dulces y Candy Bar | Mededul"
  description="Articulos sobre mesas de dulces para bodas, XV anos, eventos corporativos y fiestas. Ideas, tendencias y guias para tu evento."
  includeBlogStyles={true}
>
  <Breadcrumbs items={breadcrumbItems} />

  <Hero
    title="Blog de Mesas de Dulces"
    subtitle="Ideas y guias practicas sobre candy bar, eventos sociales y contenido relacionado con nuestros servicios."
    showCTA={false}
  />

  <BlogArchive
    posts={posts}
    featuredPosts={featuredPosts}
    categories={categories}
    currentPage={1}
    totalPages={totalPages}
  />

  <CTAServices
    href="/contacto"
    badge="Asesoria Profesional"
    title="Convierte Tu Idea en un Evento"
    titleHighlight="Inolvidable"
    text="Si ya viste opciones en el blog, te ayudamos a aterrizar una propuesta real para tu celebracion."
    buttonText="Solicitar Cotizacion"
  />
</BaseLayout>
