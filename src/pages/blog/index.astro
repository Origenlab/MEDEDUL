---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Breadcrumbs from '@/components/seo/Breadcrumbs.astro';
import BlogArchive from '@/components/blog/BlogArchive.astro';
import Hero from '@/components/global/Hero.astro';
import { getCollection } from 'astro:content';

const PAGE_SIZE = 9;
const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime());

const posts = allPosts.slice(0, PAGE_SIZE);
const totalPages = Math.ceil(allPosts.length / PAGE_SIZE);
const categories = [...new Set(allPosts.map(post => post.data.category))];
const featuredPosts = allPosts.slice(0, 4);

const breadcrumbItems = [
  { name: 'Blog', url: '/blog' }
];
---

<BaseLayout
  title="Blog de Mesas de Dulces y Candy Bar | Mededul"
  description="Articulos sobre mesas de dulces para bodas, XV anos, eventos corporativos y fiestas. Ideas, tendencias y guias para tu evento."
>
  <Breadcrumbs items={breadcrumbItems} />

  <Hero
    title="Blog de Mesas de Dulces"
    subtitle="Ideas y guías prácticas sobre candy bar, eventos sociales y contenido relacionado con nuestros servicios."
  />

  <BlogArchive
    posts={posts}
    featuredPosts={featuredPosts}
    categories={categories}
    currentPage={1}
    totalPages={totalPages}
  />
</BaseLayout>
