---
// BlogPostLayout - Layout for individual blog articles
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '@/components/seo/Breadcrumbs.astro';
import JsonLd from '@/components/seo/JsonLd.astro';
import { categoryMeta } from '@/content/config';
import { getCdnUrl } from '@/lib/cdn';
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, category, heroImage, heroImageAlt, tags, faqs } = post.data;

const siteUrl = Astro.site?.toString() || 'https://mesas-de-dulces.com';
const articleUrl = `${siteUrl}/blog/${post.slug}`;
const categoryInfo = categoryMeta[category as keyof typeof categoryMeta];
const heroSupportText = `En este articulo de ${categoryInfo?.name || category} compartimos recomendaciones claras para ayudarte a planear una mesa de dulces mejor organizada, mas atractiva y alineada a tu tipo de evento.`;

// Breadcrumb items
const breadcrumbItems = [
  { name: 'Blog', url: '/blog' },
  { name: categoryInfo?.name || category, url: `/blog/categoria/${category}` },
  { name: title, url: articleUrl }
];
---

<BaseLayout
  title={title}
  description={description}
  ogType="article"
  article={{
    category: categoryInfo?.name || category,
    tags
  }}
>
  <!-- Article JSON-LD -->
  <JsonLd
    type="Article"
    data={{
      title,
      description,
      image: getCdnUrl(heroImage),
      url: articleUrl
    }}
  />

  <!-- FAQ JSON-LD if FAQs exist -->
  {faqs && faqs.length > 0 && (
    <JsonLd type="FAQPage" data={{ faqs }} />
  )}

  <div class="header-spacer"></div>

  <Breadcrumbs items={breadcrumbItems} />

  <!-- Article Hero -->
  <section class="blog-article-hero">
    <div class="article-hero-bg-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>

    <div class="container">
      <div class="article-hero-grid">
        <div class="article-hero-left">
          <span class="article-category-tag" style={`background-color: ${categoryInfo?.color || '#E91E8C'}`}>
            {categoryInfo?.icon} {categoryInfo?.name || category}
          </span>

          <h1>{title}</h1>
        </div>

        <div class="article-hero-right">
          <p>{description}</p>
          <p>{heroSupportText}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Article Layout -->
  <div class="article-layout">
    <div class="container">
      <div class="article-grid">
        <!-- Main Content -->
        <article class="article-content">
          {heroImage && (
            <img
              src={getCdnUrl(heroImage)}
              alt={heroImageAlt}
              class="article-hero-image"
              width="800"
              height="500"
              loading="eager"
            />
          )}

          <div class="article-body">
            <slot />
          </div>

          <!-- FAQs Section -->
          {faqs && faqs.length > 0 && (
            <section class="article-faqs">
              <h2>Preguntas Frecuentes</h2>
              <div class="faq-container">
                {faqs.map((faq) => (
                  <div class="faq-item">
                    <button class="faq-question">
                      {faq.question}
                      <span class="icon">+</span>
                    </button>
                    <div class="faq-answer">
                      <p>{faq.answer}</p>
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}

          <!-- Article CTA -->
          <div class="article-cta">
            <h2>¿Listo para crear tu mesa de dulces perfecta?</h2>
            <p>Contáctanos hoy y recibe una cotización personalizada para tu evento.</p>
            <a href="/contacto" class="btn btn-primary">Cotizar Ahora</a>
          </div>
        </article>

        <!-- Sidebar -->
        <aside class="article-sidebar">
          <div class="sidebar-widget sidebar-cta">
            <h3>¿Necesitas una mesa de dulces?</h3>
            <p>Cotiza gratis tu evento</p>
            <a href="https://wa.me/525525226442" target="_blank" rel="noopener noreferrer" class="sidebar-cta-btn-wa">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/>
              </svg>
              WhatsApp
            </a>
            <a href="/contacto" class="sidebar-cta-btn">Ver Paquetes</a>
          </div>

          {tags && tags.length > 0 && (
            <div class="sidebar-widget sidebar-tags">
              <h4>Etiquetas</h4>
              <div class="tags-list">
                {tags.map(tag => (
                  <a href={`/blog/tag/${tag.toLowerCase().replace(/\s+/g, '-')}`} class="tag">{tag}</a>
                ))}
              </div>
            </div>
          )}
        </aside>
      </div>
    </div>
  </div>

  <script>
    // FAQ accordion
    document.querySelectorAll('.faq-item').forEach(item => {
      const question = item.querySelector('.faq-question');
      question?.addEventListener('click', () => {
        item.classList.toggle('active');
      });
    });
  </script>
</BaseLayout>

<style>
  .blog-article-hero {
    background: linear-gradient(135deg, #eaf7ff 0%, #f2fff8 52%, #fff8ee 100%);
    padding: 56px 0 58px;
    min-height: 0;
    display: block;
    align-items: initial;
    position: relative;
    overflow: hidden;
  }

  .blog-article-hero .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
    text-align: left;
  }

  .blog-article-hero .article-hero-bg-shapes {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .blog-article-hero .shape-1 {
    width: 400px;
    height: 400px;
    background: rgba(116, 185, 255, 0.26);
    top: -100px;
    right: -100px;
    position: absolute;
    border-radius: 50%;
    opacity: 0.75;
  }

  .blog-article-hero .shape-2 {
    width: 300px;
    height: 300px;
    background: rgba(85, 239, 196, 0.28);
    bottom: -50px;
    left: -50px;
    position: absolute;
    border-radius: 50%;
    opacity: 0.8;
  }

  .blog-article-hero .shape-3 {
    width: 200px;
    height: 200px;
    background: rgba(255, 230, 109, 0.3);
    top: 40%;
    right: 10%;
    position: absolute;
    border-radius: 50%;
    opacity: 0.75;
  }

  .blog-article-hero .article-hero-grid {
    display: grid;
    grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
    gap: 42px;
    align-items: start;
    position: relative;
    z-index: 2;
  }

  .blog-article-hero .article-hero-left h1 {
    margin-bottom: 0;
    line-height: 1.2;
    color: var(--negro-suave);
  }

  .article-category-tag {
    display: inline-block;
    padding: 8px 20px;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 18px;
    color: #fff;
  }

  .blog-article-hero .article-hero-right p {
    color: var(--gris-texto);
    line-height: 1.8;
    margin-bottom: 14px;
    font-size: 1rem;
    max-width: 62ch;
  }

  .blog-article-hero .article-hero-right p:last-child {
    margin-bottom: 0;
  }

  .blog-article-hero .article-hero-right strong {
    color: var(--rosa-principal);
  }

  .blog-article-hero .article-hero-left h1 {
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    font-weight: 800;
    line-height: 1.3;
  }

  .article-hero-meta {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    font-size: 0.9rem;
    opacity: 0.9;
  }

  .article-hero-meta span {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .article-layout {
    padding: 48px 0 60px;
    background: var(--gris-claro);
  }

  .article-grid {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 40px;
    align-items: start;
  }

  .article-content {
    background: var(--blanco);
    border-radius: var(--radio-medio);
    padding: 40px;
    box-shadow: var(--sombra-suave);
  }

  .article-hero-image {
    width: 100%;
    height: auto;
    border-radius: var(--radio-pequeno);
    margin-bottom: 30px;
  }

  .article-body :global(h2) {
    font-size: 1.6rem;
    margin: 40px 0 20px;
    color: var(--negro-suave);
  }

  .article-body :global(h3) {
    font-size: 1.3rem;
    margin: 30px 0 15px;
    color: var(--negro-suave);
  }

  .article-body :global(p) {
    margin-bottom: 20px;
    line-height: 1.8;
    color: var(--gris-texto);
  }

  .article-body :global(ul),
  .article-body :global(ol) {
    margin: 20px 0;
    padding-left: 25px;
  }

  .article-body :global(li) {
    margin-bottom: 10px;
    line-height: 1.7;
    color: var(--gris-texto);
  }

  .article-body :global(a) {
    color: var(--rosa-principal);
    text-decoration: underline;
  }

  .article-body :global(a:hover) {
    color: var(--rosa-hover);
  }

  .article-faqs {
    margin-top: 50px;
    padding-top: 40px;
    border-top: 2px solid var(--gris-claro);
  }

  .article-faqs h2 {
    font-size: 1.5rem;
    margin-bottom: 25px;
    color: var(--negro-suave);
  }

  .article-cta {
    background: var(--gradiente-dulce);
    padding: 40px;
    border-radius: var(--radio-medio);
    text-align: center;
    margin-top: 50px;
    color: var(--blanco);
  }

  .article-cta h2 {
    color: var(--blanco);
    margin-bottom: 15px;
    font-size: 1.5rem;
  }

  .article-cta p {
    margin-bottom: 25px;
    opacity: 0.95;
  }

  .article-cta .btn-primary {
    background: var(--blanco);
    color: var(--rosa-principal);
  }

  /* Sidebar */
  .article-sidebar {
    position: sticky;
    top: 200px;
  }

  .sidebar-widget {
    background: var(--blanco);
    border-radius: var(--radio-medio);
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: var(--sombra-suave);
  }

  .sidebar-cta {
    text-align: center;
  }

  .sidebar-cta h3 {
    font-size: 1.1rem;
    margin-bottom: 8px;
    color: var(--negro-suave);
  }

  .sidebar-cta p {
    color: var(--gris-texto);
    font-size: 0.9rem;
    margin-bottom: 20px;
  }

  .sidebar-cta-btn-wa {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 14px;
    background: #25D366;
    color: var(--blanco);
    border-radius: var(--radio-redondo);
    font-weight: 600;
    text-decoration: none;
    margin-bottom: 12px;
    transition: all 0.3s ease;
  }

  .sidebar-cta-btn-wa:hover {
    background: #128C7E;
  }

  .sidebar-cta-btn {
    display: block;
    width: 100%;
    padding: 14px;
    background: var(--rosa-principal);
    color: var(--blanco);
    border-radius: var(--radio-redondo);
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .sidebar-cta-btn:hover {
    background: var(--rosa-hover);
  }

  .sidebar-tags h4 {
    font-size: 1rem;
    margin-bottom: 15px;
    color: var(--negro-suave);
  }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .tag {
    padding: 6px 14px;
    background: var(--gris-claro);
    border-radius: 20px;
    font-size: 0.8rem;
    color: var(--gris-texto);
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .tag:hover {
    background: var(--rosa-principal);
    color: var(--blanco);
  }

  @media (max-width: 1024px) {
    .article-grid {
      grid-template-columns: 1fr;
    }

    .article-sidebar {
      position: static;
    }
  }

  @media (max-width: 968px) {
    .blog-article-hero .article-hero-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .blog-article-hero {
      padding: 46px 0 48px;
    }
  }

  @media (max-width: 768px) {
    .blog-article-hero {
      padding: 38px 0 42px;
    }

    .blog-article-hero .article-hero-left h1 {
      font-size: 1.75rem;
    }

    .blog-article-hero .article-hero-right p {
      font-size: 0.98rem;
      line-height: 1.72;
    }

    .article-content {
      padding: 25px;
    }

    .article-layout {
      padding: 40px 0;
    }
  }
</style>
