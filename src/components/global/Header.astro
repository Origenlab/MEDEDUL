---
// Header Component - Main navigation
import { getCdnUrl } from '@/lib/cdn';

interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;
---

<header class="header" id="header">
  <div class="container">
    <nav class="nav">
      <a href="/" class="logo">
        <img
          src={getCdnUrl("/img/branding/logo-mededul-mesas-de-dulces.avif")}
          alt="Mededul - Mesas de Dulces CDMX"
          width="225"
          height="75"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
      </a>

      <ul class="nav-menu" id="nav-menu">
        <li><a href="/" class:list={["nav-link", { active: currentPath === '/' }]}>Inicio</a></li>

        <li class="nav-dropdown">
          <a href="/servicios" class="nav-link nav-link-dropdown">
            Servicios
            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </a>
          <ul class="dropdown-menu dropdown-mega">
            <li class="dropdown-column">
              <span class="dropdown-header">Tipos de Mesas</span>
              <ul>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-dulces">Mesa de Dulces</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-frutas">Mesa de Frutas</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-postres">Mesa de Postres</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-quesos-y-embutidos">Quesos y Embutidos</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-snacks">Mesa de Snacks</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-botanas">Mesa de Botanas</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-dulces-tradicionales">Dulces Tradicionales</a></li>
                <li><a href="/tipos-de-mesas-de-dulces/mesa-de-donas-y-cupcakes">Donas y Cupcakes</a></li>
              </ul>
              <a href="/tipos-de-mesas-de-dulces" class="ver-todos">Ver todos los tipos</a>
            </li>
            <li class="dropdown-column">
              <span class="dropdown-header">Candy Bar por Evento</span>
              <ul>
                <li><a href="/candy-bar-eventos/mesa-dulces-boda">Bodas</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-xv-anos">XV Años</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-baby-shower">Baby Shower</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-bautizo">Bautizos</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-primera-comunion">Primera Comunión</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-cumpleanos-infantil">Cumpleaños Infantil</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-graduacion">Graduaciones</a></li>
                <li><a href="/candy-bar-eventos/mesa-dulces-corporativos">Corporativos</a></li>
              </ul>
              <a href="/candy-bar-eventos" class="ver-todos">Ver todos los eventos</a>
            </li>
            <li class="dropdown-column">
              <span class="dropdown-header">Estaciones Interactivas</span>
              <ul>
                <li><a href="/estaciones-interactivas/fuente-de-chocolate">Fuente de Chocolate</a></li>
                <li><a href="/estaciones-interactivas/fuente-de-chamoy">Fuente de Chamoy</a></li>
                <li><a href="/estaciones-interactivas/pared-de-dulces">Pared de Dulces</a></li>
                <li><a href="/estaciones-interactivas/stand-para-pastel">Stand para Pastel</a></li>
              </ul>
              <a href="/estaciones-interactivas" class="ver-todos">Ver todas las estaciones</a>
            </li>
            <li class="dropdown-column">
              <span class="dropdown-header">Por qué Elegirnos</span>
              <ul>
                <li><a href="/porque-mededul/diseno-personalizado">Diseño Personalizado</a></li>
                <li><a href="/porque-mededul/calidad-premium">Calidad Premium</a></li>
                <li><a href="/porque-mededul/servicio-completo">Servicio Completo</a></li>
                <li><a href="/porque-mededul/cero-estres">Cero Estrés</a></li>
              </ul>
              <a href="/porque-mededul" class="ver-todos">Conoce más de nosotros</a>
            </li>
          </ul>
        </li>

        <li><a href="/nosotros" class:list={["nav-link", { active: currentPath === '/nosotros' }]}>Nosotros</a></li>
        <li><a href="/blog" class:list={["nav-link", { active: currentPath.startsWith('/blog') }]}>Blog</a></li>
        <li><a href="/contacto" class:list={["nav-link", { active: currentPath === '/contacto' }]}>Contacto</a></li>
      </ul>

      <div class="nav-actions">
        <a href="tel:+525525226442" class="nav-phone">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
          </svg>
          <span>55 2522 6442</span>
        </a>
        <a href="/contacto" class="btn-cta-nav">Cotiza Gratis</a>
      </div>

      <button class="hamburger" id="hamburger" aria-label="Abrir menú">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
  </div>
</header>

<script>
  // Header scroll effect
  const header = document.getElementById('header');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  });

  // Mobile menu toggle
  const hamburger = document.getElementById('hamburger');
  const navMenu = document.getElementById('nav-menu');

  hamburger?.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    navMenu?.classList.toggle('active');
  });

  // Mobile dropdown toggles
  const dropdowns = document.querySelectorAll('.nav-dropdown');

  dropdowns.forEach(dropdown => {
    const link = dropdown.querySelector('.nav-link-dropdown');

    link?.addEventListener('click', (e) => {
      if (window.innerWidth <= 768) {
        e.preventDefault();
        dropdown.classList.toggle('active');

        // Close other dropdowns
        dropdowns.forEach(other => {
          if (other !== dropdown) {
            other.classList.remove('active');
          }
        });
      }
    });
  });

  // Mobile dropdown column toggles
  const dropdownColumns = document.querySelectorAll('.dropdown-column');

  dropdownColumns.forEach(column => {
    const header = column.querySelector('.dropdown-header');

    header?.addEventListener('click', (e) => {
      if (window.innerWidth <= 768) {
        e.stopPropagation();
        column.classList.toggle('active');
      }
    });
  });

  // Close menu when clicking on a link
  const navLinks = document.querySelectorAll('.nav-menu a');

  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      hamburger?.classList.remove('active');
      navMenu?.classList.remove('active');
    });
  });
</script>
