---
// Header Component - Professional Navigation
import { getCdnUrl } from '@/lib/cdn';

interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

// Navigation structure
const menuItems = [
  { label: 'Inicio', href: '/', exact: true },
  {
    label: 'Servicios',
    href: '/servicios',
    megaMenu: [
      {
        title: 'Tipos de Mesas',
        icon: 'ðŸ¬',
        color: '#B31263',
        items: [
          { label: 'Mesa de Dulces', href: '/tipos-de-mesas-de-dulces/mesa-de-dulces' },
          { label: 'Mesa de Frutas', href: '/tipos-de-mesas-de-dulces/mesa-de-frutas' },
          { label: 'Mesa de Postres', href: '/tipos-de-mesas-de-dulces/mesa-de-postres' },
          { label: 'Quesos y Embutidos', href: '/tipos-de-mesas-de-dulces/mesa-de-quesos-y-embutidos' },
          { label: 'Mesa de Snacks', href: '/tipos-de-mesas-de-dulces/mesa-de-snacks' },
          { label: 'Mesa de Botanas', href: '/tipos-de-mesas-de-dulces/mesa-de-botanas' },
          { label: 'Dulces Tradicionales', href: '/tipos-de-mesas-de-dulces/mesa-de-dulces-tradicionales' },
          { label: 'Donas y Cupcakes', href: '/tipos-de-mesas-de-dulces/mesa-de-donas-y-cupcakes' }
        ],
        viewAll: { label: 'Ver todos los tipos', href: '/tipos-de-mesas-de-dulces' }
      },
      {
        title: 'Candy Bar por Evento',
        icon: 'ðŸŽ‰',
        color: '#9B59B6',
        items: [
          { label: 'Bodas', href: '/candy-bar-eventos/mesa-dulces-boda' },
          { label: 'XV AÃ±os', href: '/candy-bar-eventos/mesa-dulces-xv-anos' },
          { label: 'Baby Shower', href: '/candy-bar-eventos/mesa-dulces-baby-shower' },
          { label: 'Bautizos', href: '/candy-bar-eventos/mesa-dulces-bautizo' },
          { label: 'Primera ComuniÃ³n', href: '/candy-bar-eventos/mesa-dulces-primera-comunion' },
          { label: 'CumpleaÃ±os Infantil', href: '/candy-bar-eventos/mesa-dulces-cumpleanos-infantil' },
          { label: 'Graduaciones', href: '/candy-bar-eventos/mesa-dulces-graduacion' },
          { label: 'Corporativos', href: '/candy-bar-eventos/mesa-dulces-corporativos' }
        ],
        viewAll: { label: 'Ver todos los eventos', href: '/candy-bar-eventos' }
      },
      {
        title: 'Estaciones Interactivas',
        icon: 'â­',
        color: '#F39C12',
        items: [
          { label: 'Fuente de Chocolate', href: '/estaciones-interactivas/fuente-de-chocolate' },
          { label: 'Fuente de Chamoy', href: '/estaciones-interactivas/fuente-de-chamoy' },
          { label: 'Pared de Dulces', href: '/estaciones-interactivas/pared-de-dulces' },
          { label: 'Stand para Pastel', href: '/estaciones-interactivas/stand-para-pastel' }
        ],
        viewAll: { label: 'Ver todas las estaciones', href: '/estaciones-interactivas' }
      },
      {
        title: 'Por quÃ© Elegirnos',
        icon: 'ðŸ’Ž',
        color: '#3498DB',
        items: [
          { label: 'DiseÃ±o Personalizado', href: '/porque-mededul/diseno-personalizado' },
          { label: 'Calidad Premium', href: '/porque-mededul/calidad-premium' },
          { label: 'Servicio Completo', href: '/porque-mededul/servicio-completo' },
          { label: 'Cero EstrÃ©s', href: '/porque-mededul/cero-estres' }
        ],
        viewAll: { label: 'Conoce mÃ¡s', href: '/porque-mededul' }
      }
    ]
  },
  { label: 'Nosotros', href: '/nosotros' },
  { label: 'Blog', href: '/blog', startsWith: true },
  { label: 'Contacto', href: '/contacto' }
];

// Check if link is active
const isActive = (item: typeof menuItems[0]) => {
  if (item.exact) return currentPath === item.href;
  if (item.startsWith) return currentPath.startsWith(item.href);
  return currentPath === item.href;
};
---

<header class="header" id="header">
  <div class="header__container">
    <!-- Logo -->
    <a href="/" class="header__logo">
      <picture>
        <source
          type="image/avif"
          srcset={`${getCdnUrl('/img/branding/logo-mededul-mesas-de-dulces.avif', { w: 190 })} 190w, ${getCdnUrl('/img/branding/logo-mededul-mesas-de-dulces.avif', { w: 280 })} 280w, ${getCdnUrl('/img/branding/logo-mededul-mesas-de-dulces.avif', { w: 560 })} 560w`}
          sizes="(max-width: 480px) 190px, (max-width: 768px) 230px, 280px"
        />
        <img
          src={getCdnUrl('/img/branding/logo-mededul-mesas-de-dulces.avif', { w: 560 })}
          alt="Mededul - Mesas de Dulces CDMX"
          width="1296"
          height="330"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
      </picture>
    </a>

    <!-- Desktop Navigation -->
    <nav class="header__nav" id="nav-menu">
      <ul class="header__menu">
        {menuItems.map(item => (
          <li class:list={['header__item', { 'has-mega': item.megaMenu }]}>
            <a
              href={item.href}
              class:list={['header__link', { active: isActive(item) }]}
            >
              {item.label}
              {item.megaMenu && (
                <svg class="header__arrow" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              )}
            </a>

            {item.megaMenu && (
              <div class="mega-menu">
                <div class="mega-menu__container">
                  {item.megaMenu.map(column => (
                    <div class="mega-menu__column">
                      <div class="mega-menu__header" style={`--column-color: ${column.color}`}>
                        <span class="mega-menu__icon">{column.icon}</span>
                        <span class="mega-menu__title">{column.title}</span>
                      </div>
                      <ul class="mega-menu__list">
                        {column.items.map(subItem => (
                          <li>
                            <a href={subItem.href} class="mega-menu__link">
                              {subItem.label}
                            </a>
                          </li>
                        ))}
                      </ul>
                      <a href={column.viewAll.href} class="mega-menu__view-all" style={`--column-color: ${column.color}`}>
                        {column.viewAll.label}
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                      </a>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </li>
        ))}
      </ul>
    </nav>

    <!-- Actions -->
    <div class="header__actions">
      <a href="tel:+525525226442" class="header__phone">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
        </svg>
        <span>55 2522 6442</span>
      </a>
      <a href="/contacto" class="header__cta">
        Cotiza Gratis
      </a>
    </div>

    <!-- Mobile Toggle -->
    <button class="header__toggle" id="hamburger" aria-label="Abrir menÃº">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu__inner">
      <ul class="mobile-menu__list">
        {menuItems.map(item => (
          <li class:list={['mobile-menu__item', { 'has-submenu': item.megaMenu }]}>
            {item.megaMenu ? (
              <>
                <button class="mobile-menu__link mobile-menu__trigger" type="button">
                  {item.label}
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="6 9 12 15 18 9" />
                  </svg>
                </button>
                <div class="mobile-menu__submenu">
                  {item.megaMenu.map(column => (
                    <div class="mobile-menu__group">
                      <button class="mobile-menu__group-header" type="button" style={`--column-color: ${column.color}`}>
                        <span class="mobile-menu__group-icon">{column.icon}</span>
                        {column.title}
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                          <polyline points="6 9 12 15 18 9" />
                        </svg>
                      </button>
                      <ul class="mobile-menu__group-list">
                        {column.items.map(subItem => (
                          <li>
                            <a href={subItem.href} class="mobile-menu__sublink">{subItem.label}</a>
                          </li>
                        ))}
                        <li>
                          <a href={column.viewAll.href} class="mobile-menu__view-all">{column.viewAll.label}</a>
                        </li>
                      </ul>
                    </div>
                  ))}
                </div>
              </>
            ) : (
              <a href={item.href} class:list={['mobile-menu__link', { active: isActive(item) }]}>
                {item.label}
              </a>
            )}
          </li>
        ))}
      </ul>

      <div class="mobile-menu__footer">
        <a href="tel:+525525226442" class="mobile-menu__phone">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
          </svg>
          55 2522 6442
        </a>
        <a href="/contacto" class="mobile-menu__cta">
          Cotiza Gratis
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Scroll effect
  const header = document.getElementById('header');

  window.addEventListener('scroll', () => {
    const currentScroll = window.scrollY;
    if (currentScroll > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  });

  // Mobile menu toggle
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.getElementById('mobile-menu');

  hamburger?.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    mobileMenu?.classList.toggle('active');
    document.body.classList.toggle('menu-open');
  });

  // Mobile submenu toggles
  const triggers = document.querySelectorAll('.mobile-menu__trigger');
  triggers.forEach(trigger => {
    trigger.addEventListener('click', () => {
      const parent = trigger.parentElement;
      parent?.classList.toggle('open');
    });
  });

  // Mobile group toggles
  const groupHeaders = document.querySelectorAll('.mobile-menu__group-header');
  groupHeaders.forEach(header => {
    header.addEventListener('click', () => {
      const parent = header.parentElement;
      parent?.classList.toggle('open');
    });
  });

  // Close mobile menu on link click
  const mobileLinks = document.querySelectorAll('.mobile-menu__link:not(.mobile-menu__trigger), .mobile-menu__sublink, .mobile-menu__view-all');
  mobileLinks.forEach(link => {
    link.addEventListener('click', () => {
      hamburger?.classList.remove('active');
      mobileMenu?.classList.remove('active');
      document.body.classList.remove('menu-open');
    });
  });
</script>

<style>
  /* =====================================================
     HEADER - Professional Design
     ===================================================== */
  .header {
    position: fixed;
    top: 38px;
    left: 0;
    right: 0;
    z-index: 1000;
    background: #ffffff;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
  }

  .header.scrolled {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .header__container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 28px 30px;
    min-height: 111px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  /* Logo */
  .header__logo {
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .header__logo img {
    max-height: 90px;
    width: auto;
    max-width: 280px;
    display: block;
    object-fit: contain;
  }

  /* Navigation */
  .header__nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .header__menu {
    display: flex;
    align-items: center;
    gap: 8px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__item {
    position: relative;
  }

  .header__link {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 12px 18px;
    font-size: 0.95rem;
    font-weight: 500;
    color: #333;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .header__link:hover {
    color: #B31263;
    background: rgba(233, 30, 140, 0.05);
  }

  .header__link.active {
    color: #B31263;
  }

  .header__link.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 16px;
    right: 16px;
    height: 2px;
    background: #B31263;
    border-radius: 2px;
  }

  .header__arrow {
    transition: transform 0.2s ease;
  }

  .header__item.has-mega:hover .header__arrow {
    transform: rotate(180deg);
  }

  /* Mega Menu */
  .mega-menu {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding-top: 15px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.25s ease;
  }

  .header__item.has-mega:hover .mega-menu {
    opacity: 1;
    visibility: visible;
  }

  .mega-menu__container {
    display: grid;
    grid-template-columns: repeat(4, 220px);
    gap: 0;
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    overflow: hidden;
  }

  .mega-menu__column {
    padding: 24px 20px;
    border-right: 1px solid #f0f0f0;
  }

  .mega-menu__column:last-child {
    border-right: none;
  }

  .mega-menu__header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--column-color, #B31263);
  }

  .mega-menu__icon {
    font-size: 1.2rem;
  }

  .mega-menu__title {
    font-size: 0.85rem;
    font-weight: 700;
    color: #1a1a1a;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .mega-menu__list {
    list-style: none;
    padding: 0;
    margin: 0 0 16px;
  }

  .mega-menu__list li {
    margin-bottom: 4px;
  }

  .mega-menu__link {
    display: block;
    padding: 8px 12px;
    font-size: 0.9rem;
    color: #555;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.15s ease;
  }

  .mega-menu__link:hover {
    color: #B31263;
    background: rgba(233, 30, 140, 0.06);
    padding-left: 16px;
  }

  .mega-menu__view-all {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--column-color, #B31263);
    text-decoration: none;
    padding: 8px 0;
    transition: gap 0.2s ease;
  }

  .mega-menu__view-all:hover {
    gap: 10px;
  }

  /* Actions */
  .header__actions {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-shrink: 0;
  }

  .header__phone {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    font-size: 0.95rem;
    font-weight: 500;
    color: #333;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .header__phone:hover {
    color: #B31263;
    background: rgba(233, 30, 140, 0.05);
  }

  .header__phone svg {
    color: #B31263;
  }

  .header__cta {
    display: inline-flex;
    align-items: center;
    padding: 14px 28px;
    font-size: 0.95rem;
    font-weight: 600;
    color: #ffffff;
    background: linear-gradient(135deg, #B31263 0%, #C4177A 100%);
    border-radius: 50px;
    text-decoration: none;
    box-shadow: 0 4px 15px rgba(233, 30, 140, 0.3);
    transition: all 0.2s ease;
  }

  .header__cta:hover {
    box-shadow: 0 6px 20px rgba(233, 30, 140, 0.4);
    transform: translateY(-1px);
  }

  /* Mobile Toggle */
  .header__toggle {
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
    width: 48px;
    height: 48px;
    padding: 12px;
    background: none;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.2s ease;
  }

  .header__toggle:active {
    background: rgba(0, 0, 0, 0.05);
  }

  .header__toggle span {
    display: block;
    width: 24px;
    height: 2px;
    background: #333;
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .header__toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .header__toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .header__toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(5px, -5px);
  }

  /* Mobile Menu */
  .mobile-menu {
    display: none;
    position: fixed;
    top: calc(38px + 111px);
    left: 0;
    right: 0;
    bottom: 0;
    background: #ffffff;
    overflow-y: auto;
    transform: translateX(100%);
    transition: transform 0.3s ease;
  }

  .mobile-menu.active {
    transform: translateX(0);
  }

  .mobile-menu__inner {
    padding: 20px;
    min-height: 100%;
    display: flex;
    flex-direction: column;
  }

  .mobile-menu__list {
    list-style: none;
    padding: 0;
    margin: 0;
    flex: 1;
  }

  .mobile-menu__item {
    border-bottom: 1px solid #f0f0f0;
  }

  .mobile-menu__link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 16px 0;
    font-size: 1.1rem;
    font-weight: 500;
    color: #333;
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
  }

  .mobile-menu__link.active {
    color: #B31263;
  }

  .mobile-menu__link svg {
    transition: transform 0.2s ease;
  }

  .mobile-menu__item.open > .mobile-menu__trigger svg {
    transform: rotate(180deg);
  }

  /* Mobile Submenu */
  .mobile-menu__submenu {
    display: none;
    padding-bottom: 16px;
  }

  .mobile-menu__item.open .mobile-menu__submenu {
    display: block;
  }

  .mobile-menu__group {
    margin-bottom: 8px;
  }

  .mobile-menu__group-header {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 12px 16px;
    font-size: 0.95rem;
    font-weight: 600;
    color: #333;
    background: rgba(0, 0, 0, 0.02);
    border: none;
    border-left: 3px solid var(--column-color, #B31263);
    border-radius: 0 8px 8px 0;
    cursor: pointer;
    text-align: left;
  }

  .mobile-menu__group-icon {
    font-size: 1rem;
  }

  .mobile-menu__group-header svg {
    margin-left: auto;
    transition: transform 0.2s ease;
  }

  .mobile-menu__group.open .mobile-menu__group-header svg {
    transform: rotate(180deg);
  }

  .mobile-menu__group-list {
    display: none;
    list-style: none;
    padding: 8px 0 8px 24px;
    margin: 0;
  }

  .mobile-menu__group.open .mobile-menu__group-list {
    display: block;
  }

  .mobile-menu__sublink {
    display: block;
    padding: 10px 16px;
    font-size: 0.95rem;
    color: #555;
    text-decoration: none;
    border-radius: 6px;
  }

  .mobile-menu__sublink:hover {
    color: #B31263;
    background: rgba(233, 30, 140, 0.05);
  }

  .mobile-menu__view-all {
    display: block;
    padding: 10px 16px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #B31263;
    text-decoration: none;
  }

  /* Mobile Footer */
  .mobile-menu__footer {
    padding: 20px 0;
    border-top: 1px solid #f0f0f0;
    margin-top: auto;
  }

  .mobile-menu__phone {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 14px;
    font-size: 1rem;
    font-weight: 500;
    color: #333;
    text-decoration: none;
    background: #f8f8f8;
    border-radius: 10px;
    margin-bottom: 12px;
  }

  .mobile-menu__phone svg {
    color: #B31263;
  }

  .mobile-menu__cta {
    display: block;
    width: 100%;
    padding: 16px;
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    text-align: center;
    text-decoration: none;
    background: linear-gradient(135deg, #B31263 0%, #C4177A 100%);
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(233, 30, 140, 0.3);
  }

  /* =====================================================
     RESPONSIVE
     ===================================================== */
  @media (max-width: 1200px) {
    .mega-menu__container {
      grid-template-columns: repeat(4, 200px);
    }

    .mega-menu__column {
      padding: 20px 16px;
    }
  }

  @media (max-width: 1024px) {
    .header__nav,
    .header__actions {
      display: none;
    }

    .header__toggle {
      display: flex;
    }

    .mobile-menu {
      display: block;
    }
  }

  @media (max-width: 768px) {
    .header {
      top: 34px;
    }

    .header__container {
      padding: 22px 16px;
      min-height: 92px;
    }

    .header__logo img {
      max-height: 72px;
      max-width: 230px;
    }

    .mobile-menu {
      top: calc(34px + 92px);
    }
  }

  @media (max-width: 480px) {
    .header {
      top: 30px;
    }

    .header__container {
      padding: 18px 12px;
      min-height: 78px;
    }

    .header__logo img {
      max-height: 60px;
      max-width: 190px;
    }

    .mobile-menu {
      top: calc(30px + 78px);
    }

    .mobile-menu__inner {
      padding: 16px;
    }

    .mobile-menu__link {
      padding: 14px 0;
      font-size: 1rem;
    }
  }

  /* Body scroll lock when menu is open */
  :global(body.menu-open) {
    overflow: hidden;
  }
</style>
